import{a as l,o as e,w as De}from"./chunk-ZYFC6VSF-B3aerHc2.js";import{C as h,B as J,F as he,b as B,I as O,a as P,A as E,S as We,U as _e}from"./username-input-Cua_Ov2M.js";import{a as N,c as g,d as Ge,e as Ve,f as qe,g as Je}from"./CardHeaderContext-08KsEWZb.js";import{e as Pe,m as Qe,h as Q,f as Xe,B as Ye,l as me,A as Ze,n as et,r as ce,M as tt,i as st,F as xe,k as nt,o as at,p as rt,q as ot}from"./AbstractModalHeader-B3hls52t.js";import"./index-CG_zdRRE.js";function lt(s){const t=l.useRef(s);return t.current=s,t}function ct(s){const t=lt(s);l.useEffect(()=>()=>t.current(),[])}const fe=l.forwardRef(({bsPrefix:s,active:t,disabled:a,eventKey:n,className:r,variant:o,action:f,as:i,...m},d)=>{s=N(s,"list-group-item");const[u,y]=Pe({key:Qe(n,m.href),active:t,...m}),x=Q(v=>{if(a){v.preventDefault(),v.stopPropagation();return}u.onClick(v)});a&&m.tabIndex===void 0&&(m.tabIndex=-1,m["aria-disabled"]=!0);const p=i||(f?m.href?"a":"button":"div");return e.jsx(p,{ref:d,...m,...u,onClick:x,className:g(r,s,y.isActive&&"active",a&&"disabled",o&&`${s}-${o}`,f&&`${s}-action`)})});fe.displayName="ListGroupItem";const ye=l.forwardRef((s,t)=>{const{className:a,bsPrefix:n,variant:r,horizontal:o,numbered:f,as:i="div",...m}=Xe(s,{activeKey:"onSelect"}),d=N(n,"list-group");let u;return o&&(u=o===!0?"horizontal":`horizontal-${o}`),e.jsx(Ye,{ref:t,...m,as:i,className:g(a,d,r&&`${d}-${r}`,u&&`${d}-${u}`,f&&`${d}-numbered`)})});ye.displayName="ListGroup";const I=Object.assign(ye,{Item:fe});var $;function ie(s){if((!$&&$!==0||s)&&me){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),$=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return $}function it(){return l.useState(null)}const je=l.forwardRef(({className:s,bsPrefix:t,as:a="div",...n},r)=>(t=N(t,"modal-body"),e.jsx(a,{ref:r,className:g(s,t),...n})));je.displayName="ModalBody";const X=l.forwardRef(({bsPrefix:s,className:t,contentClassName:a,centered:n,size:r,fullscreen:o,children:f,scrollable:i,...m},d)=>{s=N(s,"modal");const u=`${s}-dialog`,y=typeof o=="string"?`${s}-fullscreen-${o}`:`${s}-fullscreen`;return e.jsx("div",{...m,ref:d,className:g(u,t,r&&`${s}-${r}`,n&&`${u}-centered`,i&&`${u}-scrollable`,o&&y),children:e.jsx("div",{className:g(`${s}-content`,a),children:f})})});X.displayName="ModalDialog";const pe=l.forwardRef(({className:s,bsPrefix:t,as:a="div",...n},r)=>(t=N(t,"modal-footer"),e.jsx(a,{ref:r,className:g(s,t),...n})));pe.displayName="ModalFooter";const ge=l.forwardRef(({bsPrefix:s,className:t,closeLabel:a="Close",closeButton:n=!1,...r},o)=>(s=N(s,"modal-header"),e.jsx(Ze,{ref:o,...r,className:g(t,s),closeLabel:a,closeButton:n})));ge.displayName="ModalHeader";const dt=Ge("h4"),ve=l.forwardRef(({className:s,bsPrefix:t,as:a=dt,...n},r)=>(t=N(t,"modal-title"),e.jsx(a,{ref:r,className:g(s,t),...n})));ve.displayName="ModalTitle";function ut(s){return e.jsx(xe,{...s,timeout:null})}function ht(s){return e.jsx(xe,{...s,timeout:null})}const we=l.forwardRef(({bsPrefix:s,className:t,style:a,dialogClassName:n,contentClassName:r,children:o,dialogAs:f=X,"data-bs-theme":i,"aria-labelledby":m,"aria-describedby":d,"aria-label":u,show:y=!1,animation:x=!0,backdrop:p=!0,keyboard:v=!0,onEscapeKeyDown:C,onShow:H,onHide:S,container:L,autoFocus:z=!0,enforceFocus:D=!0,restoreFocus:j=!0,restoreFocusOptions:k,onEntered:b,onExit:M,onExiting:W,onEnter:U,onEntering:_,onExited:Y,backdropClassName:Z,manager:ee,...Ne},Ce)=>{const[ke,Se]=l.useState({}),[Me,te]=l.useState(!1),G=l.useRef(!1),V=l.useRef(!1),K=l.useRef(null),[R,be]=it(),Te=et(Ce,be),se=Q(S),Be=Ve();s=N(s,"modal");const Ke=l.useMemo(()=>({onHide:se}),[se]);function ne(){return ee||nt({isRTL:Be})}function ae(c){if(!me)return;const T=ne().getScrollbarWidth()>0,le=c.scrollHeight>rt(c).documentElement.clientHeight;Se({paddingRight:T&&!le?ie():void 0,paddingLeft:!T&&le?ie():void 0})}const q=Q(()=>{R&&ae(R.dialog)});ct(()=>{ce(window,"resize",q),K.current==null||K.current()});const Re=()=>{G.current=!0},Ue=c=>{G.current&&R&&c.target===R.dialog&&(V.current=!0),G.current=!1},re=()=>{te(!0),K.current=ot(R.dialog,()=>{te(!1)})},Ie=c=>{c.target===c.currentTarget&&re()},$e=c=>{if(p==="static"){Ie(c);return}if(V.current||c.target!==c.currentTarget){V.current=!1;return}S==null||S()},Ae=c=>{v?C==null||C(c):(c.preventDefault(),p==="static"&&re())},Ee=(c,T)=>{c&&ae(c),U==null||U(c,T)},Fe=c=>{K.current==null||K.current(),M==null||M(c)},Oe=(c,T)=>{_==null||_(c,T),at(window,"resize",q)},He=c=>{c&&(c.style.display=""),Y==null||Y(c),ce(window,"resize",q)},Le=l.useCallback(c=>e.jsx("div",{...c,className:g(`${s}-backdrop`,Z,!x&&"show")}),[x,Z,s]),oe={...a,...ke};oe.display="block";const ze=c=>e.jsx("div",{role:"dialog",...c,style:oe,className:g(t,s,Me&&`${s}-static`,!x&&"show"),onClick:p?$e:void 0,onMouseUp:Ue,"data-bs-theme":i,"aria-label":u,"aria-labelledby":m,"aria-describedby":d,children:e.jsx(f,{...Ne,onMouseDown:Re,className:n,contentClassName:r,children:o})});return e.jsx(tt.Provider,{value:Ke,children:e.jsx(st,{show:y,ref:Te,backdrop:p,container:L,keyboard:!0,autoFocus:z,enforceFocus:D,restoreFocus:j,restoreFocusOptions:k,onEscapeKeyDown:Ae,onShow:H,onHide:S,onEnter:Ee,onEntering:Oe,onEntered:b,onExit:Fe,onExiting:W,onExited:He,manager:ne(),transition:x?ut:void 0,backdropTransition:x?ht:void 0,renderBackdrop:Le,renderDialog:ze})})});we.displayName="Modal";const w=Object.assign(we,{Body:je,Header:ge,Title:ve,Footer:pe,Dialog:X,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),F=l.forwardRef(({bsPrefix:s,className:t,as:a="div",...n},r)=>{const o=N(s,"row"),f=qe(),i=Je(),m=`${o}-cols`,d=[];return f.forEach(u=>{const y=n[u];delete n[u];let x;y!=null&&typeof y=="object"?{cols:x}=y:x=y;const p=u!==i?`-${u}`:"";x!=null&&d.push(`${m}${p}-${x}`)}),e.jsx(a,{ref:r,...n,className:g(t,o,...d)})});F.displayName="Row";function mt({name:s,masterPassword:t,privateKey:a,publicKey:n}){return e.jsx(h,{className:"mb-1",children:e.jsxs(h.Body,{children:[e.jsx(h.Title,{children:s}),t&&e.jsx(h.Text,{className:"mb-1",children:t}),a&&e.jsxs(h.Text,{className:"mb-1",children:[e.jsx("b",{children:"Private Key:"})," ",a]}),n&&e.jsxs(h.Text,{className:"mb-1",children:[e.jsx("b",{children:"Public Key:"})," ",n]})]})})}function xt({username:s,keys:t,copyKeysToClipboardClickedCallback:a}){const n=()=>{const r=JSON.stringify({username:s,keys:t},null,2);navigator.clipboard.writeText(r),a()};return e.jsx(h,{className:"w-100",style:{maxWidth:"700px"},children:e.jsxs(h.Body,{children:[e.jsx(h.Title,{children:"New Keys"}),t.map((r,o)=>e.jsx(mt,{...r},o)),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(J,{variant:"outline-secondary",onClick:()=>{n()},children:"Copy Keys to Clipboard"})})})]})})}function de({label:s,checked:t,onChange:a}){return e.jsx("div",{className:"form-check",children:e.jsx(he.Check,{id:s,type:"checkbox",checked:t,onChange:n=>a(n.target.checked),label:s})})}const ue=({type:s,authority:t})=>{const a=s==="account"?t.account_auths:t.key_auths;return e.jsxs(I,{className:"my-2",children:[e.jsx(I.Item,{variant:"secondary",children:e.jsxs(F,{children:[e.jsx(B,{children:e.jsx("strong",{children:s==="account"?"Account":"Key"})}),e.jsx(B,{className:"text-end",children:e.jsx("strong",{children:"Weight"})})]})}),a.map(([n,r],o)=>e.jsx(I.Item,{children:e.jsxs(F,{children:[e.jsx(B,{children:s==="account"?`@${n}`:n.toString()}),e.jsx(B,{className:"text-end",children:r})]})},o)),e.jsx(I.Item,{variant:"light",children:e.jsxs(F,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Weight Threshold"})}),e.jsx(B,{className:"text-end",children:t.weight_threshold})]})},s+" threshold")]})},A=({name:s,authority:t,memoKey:a})=>e.jsxs(h,{className:"mb-2",children:[e.jsx(h.Header,{children:e.jsx(h.Title,{children:s})}),e.jsxs(h.Body,{children:[t&&t.account_auths.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h.Title,{children:"Accounts"}),e.jsx(ue,{type:"account",authority:t})]}),t&&t.key_auths.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h.Title,{children:"Keys"}),e.jsx(ue,{type:"key",authority:t})]}),a&&e.jsx(e.Fragment,{children:e.jsx(h.Text,{children:a.toString()})})]})]}),ft=({label:s,value:t,onChange:a})=>e.jsxs(O,{children:[e.jsx(O.Text,{children:s}),e.jsx(he.Control,{type:"text",value:t,onChange:n=>a(n.target.value)})]});function yt({updatedAccountData:s,onCancel:t,show:a}){const[n,r]=l.useState(""),[o,f]=l.useState(null),[i,m]=l.useState(!1),d=async()=>{const u=await E.accountUpdateBroadcast(s,n);f(u)};return l.useEffect(()=>{o&&o.id.length>0&&m(!0)},[o]),e.jsxs(w,{show:a,onHide:t,children:[e.jsx(w.Header,{children:e.jsx(w.Title,{children:"Broadcast Update"})}),e.jsxs(w.Body,{children:[e.jsx("p",{children:"Enter your owner key:"}),e.jsx(ft,{label:"Owner Key",value:n,onChange:r}),e.jsx("div",{className:"mt-3 d-flex justify-content-end",children:e.jsx(P,{variant:"outline-primary",onClick:d,children:"Broadcast Update"})}),i&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:"Transaction Broadcasted Successfully!"}),e.jsxs("p",{children:["Transaction ID: ",o.id]}),e.jsx("p",{children:e.jsx("a",{href:`https://hivehub.dev/tx/${o.id}`,target:"_blank",rel:"noopener noreferrer",children:"View on HiveHub"})})]})]})]})}function jt({username:s,updatedAccountData:t,show:a,onCancel:n,onUpdate:r}){return e.jsx(e.Fragment,{children:e.jsxs(w,{size:"lg",centered:!0,show:a,onHide:n,children:[e.jsx(w.Header,{children:e.jsx(w.Title,{children:"Account Update"})}),e.jsx(w.Body,{children:t?e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to update the account ",e.jsxs("b",{children:["@",s]})," ","with the following authorities?"]}),e.jsxs("div",{children:[e.jsx(A,{name:"Owner",authority:t.owner}),e.jsx(A,{name:"Active",authority:t.active}),e.jsx(A,{name:"Posting",authority:t.posting}),e.jsx(A,{name:"Memo Key",memoKey:t.memo_key})]})]}):e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(We,{}),e.jsx("p",{children:"Fetching account data..."})]})}),e.jsxs(w.Footer,{children:[e.jsx(J,{variant:"outline-secondary",onClick:n,children:"Cancel"}),e.jsx(J,{variant:"outline-primary",onClick:r,children:"Update"})]})]})})}const Ct=De(function(){const[t,a]=l.useState(!1),[n,r]=l.useState(!1),[o,f]=l.useState(!1),[i,m]=l.useState(void 0),[d,u]=l.useState(""),[y,x]=l.useState(!1),[p,v]=l.useState(!1),[C,H]=l.useState(null),S=async j=>{f(!1),r(!1),a(!1);const{masterPassword:k,ownerPrivateKey:b,activePrivateKey:M,postingPrivateKey:W,memoPrivateKey:U}=E.generateNewSetOfKeys(j);m({masterPassword:k,ownerPrivateKey:b,activePrivateKey:M,postingPrivateKey:W,memoPrivateKey:U})},L=()=>t?!0:(alert("Please copy the keys to clipboard first."),!1),z=()=>{if(i){const j=E.createNewAuthoritiesFromKeys(d,i);E.getUpdatedAccountData(d,j).then(k=>{H(k)}),x(!0)}},D=()=>{C&&(x(!1),v(!0))};return e.jsxs("div",{className:"container mt-4 d-flex flex-column justify-content-center align-items-center",children:[e.jsxs(h,{className:"w-100",style:{maxWidth:"700px"},children:[e.jsxs(h.Header,{children:[e.jsx(h.Title,{children:"Change Keys"}),e.jsx(h.Text,{children:"Enter your username to generate new keys."})]}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"row justify-content-center",children:e.jsxs(O,{className:"w-100",style:{maxWidth:"500px"},children:[e.jsx(O.Text,{children:"@"}),e.jsx(_e,{onChangeCallback:u,onEnterCallback:()=>S(d),value:d}),e.jsx(P,{variant:"outline-secondary",onClick:()=>{S(d)},children:"Generate Keys"})]})}),i&&e.jsxs("div",{children:[e.jsx("div",{className:"mt-3",children:e.jsx(xt,{username:d,keys:[{name:"Master Password",masterPassword:i==null?void 0:i.masterPassword.toString(),privateKey:void 0,publicKey:void 0},...["Owner","Active","Posting","Memo"].map(j=>{var b,M;const k=j.toLowerCase()+"PrivateKey";return{name:j,masterPassword:void 0,privateKey:(b=i==null?void 0:i[k])==null?void 0:b.toString(),publicKey:(M=i==null?void 0:i[k])==null?void 0:M.createPublic().toString()}})],copyKeysToClipboardClickedCallback:()=>a(!0)})}),e.jsxs("div",{className:"mt-3",children:[e.jsx(de,{label:"I have safely copied the keys and saved them outside of Keychain",checked:n,onChange:j=>{j&&L()&&r(j)}}),e.jsx(de,{label:"I understand that Keychain should not be considered as the primary place of storage for my keys",checked:o,onChange:j=>f(j)})]}),e.jsx("div",{className:"mt-1 d-flex justify-content-end",children:e.jsx(P,{variant:o&&n?"outline-primary":"outline-secondary",onClick:()=>{z()},disabled:!(o&&n),children:"Next"})})]})]})]}),y&&i&&C&&e.jsx(jt,{username:d,updatedAccountData:C,show:y,onCancel:()=>{x(!1),v(!1)},onUpdate:()=>{D()}}),p&&C&&e.jsx(yt,{updatedAccountData:C,onCancel:()=>v(!1),show:p})]})});export{Ct as default};
