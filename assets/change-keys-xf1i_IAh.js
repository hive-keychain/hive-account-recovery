import{a as o,o as e,w as ze}from"./chunk-ZYFC6VSF-WaFGL593.js";import{C as y,B as q,F as he,a as $,I as P,b as J,A as O,S as De,U as We}from"./username-input-B9UdNExX.js";import{a as M,c as C,d as _e,e as Ge,f as Ve,g as qe}from"./CardHeaderContext-CdCLIPu2.js";import{e as Je,m as Qe,h as Q,f as Xe,B as Ye,l as me,A as Ze,n as et,r as le,M as tt,i as st,F as fe,k as nt,o as at,p as rt,q as ot}from"./AbstractModalHeader-BWYP-iUD.js";import"./index-C9Zuh_Br.js";function it(s){const t=o.useRef(s);return t.current=s,t}function lt(s){const t=it(s);o.useEffect(()=>()=>t.current(),[])}const xe=o.forwardRef(({bsPrefix:s,active:t,disabled:a,eventKey:n,className:i,variant:r,action:d,as:c,...m},u)=>{s=M(s,"list-group-item");const[h,p]=Je({key:Qe(n,m.href),active:t,...m}),f=Q(j=>{if(a){j.preventDefault(),j.stopPropagation();return}h.onClick(j)});a&&m.tabIndex===void 0&&(m.tabIndex=-1,m["aria-disabled"]=!0);const g=c||(d?m.href?"a":"button":"div");return e.jsx(g,{ref:u,...m,...h,onClick:f,className:C(i,s,p.isActive&&"active",a&&"disabled",r&&`${s}-${r}`,d&&`${s}-action`)})});xe.displayName="ListGroupItem";const ye=o.forwardRef((s,t)=>{const{className:a,bsPrefix:n,variant:i,horizontal:r,numbered:d,as:c="div",...m}=Xe(s,{activeKey:"onSelect"}),u=M(n,"list-group");let h;return r&&(h=r===!0?"horizontal":`horizontal-${r}`),e.jsx(Ye,{ref:t,...m,as:c,className:C(a,u,i&&`${u}-${i}`,h&&`${u}-${h}`,d&&`${u}-numbered`)})});ye.displayName="ListGroup";const I=Object.assign(ye,{Item:xe});var U;function ce(s){if((!U&&U!==0||s)&&me){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),U=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return U}function ct(){return o.useState(null)}const je=o.forwardRef(({className:s,bsPrefix:t,as:a="div",...n},i)=>(t=M(t,"modal-body"),e.jsx(a,{ref:i,className:C(s,t),...n})));je.displayName="ModalBody";const X=o.forwardRef(({bsPrefix:s,className:t,contentClassName:a,centered:n,size:i,fullscreen:r,children:d,scrollable:c,...m},u)=>{s=M(s,"modal");const h=`${s}-dialog`,p=typeof r=="string"?`${s}-fullscreen-${r}`:`${s}-fullscreen`;return e.jsx("div",{...m,ref:u,className:C(h,t,i&&`${s}-${i}`,n&&`${h}-centered`,c&&`${h}-scrollable`,r&&p),children:e.jsx("div",{className:C(`${s}-content`,a),children:d})})});X.displayName="ModalDialog";const pe=o.forwardRef(({className:s,bsPrefix:t,as:a="div",...n},i)=>(t=M(t,"modal-footer"),e.jsx(a,{ref:i,className:C(s,t),...n})));pe.displayName="ModalFooter";const ge=o.forwardRef(({bsPrefix:s,className:t,closeLabel:a="Close",closeButton:n=!1,...i},r)=>(s=M(s,"modal-header"),e.jsx(Ze,{ref:r,...i,className:C(t,s),closeLabel:a,closeButton:n})));ge.displayName="ModalHeader";const dt=_e("h4"),ve=o.forwardRef(({className:s,bsPrefix:t,as:a=dt,...n},i)=>(t=M(t,"modal-title"),e.jsx(a,{ref:i,className:C(s,t),...n})));ve.displayName="ModalTitle";function ut(s){return e.jsx(fe,{...s,timeout:null})}function ht(s){return e.jsx(fe,{...s,timeout:null})}const we=o.forwardRef(({bsPrefix:s,className:t,style:a,dialogClassName:n,contentClassName:i,children:r,dialogAs:d=X,"data-bs-theme":c,"aria-labelledby":m,"aria-describedby":u,"aria-label":h,show:p=!1,animation:f=!0,backdrop:g=!0,keyboard:j=!0,onEscapeKeyDown:w,onShow:x,onHide:k,container:H,autoFocus:L=!0,enforceFocus:z=!0,restoreFocus:v=!0,restoreFocusOptions:b,onEntered:S,onExit:K,onExiting:D,onEnter:A,onEntering:W,onExited:Y,backdropClassName:Z,manager:ee,...Ce},Ne)=>{const[Me,be]=o.useState({}),[ke,te]=o.useState(!1),_=o.useRef(!1),G=o.useRef(!1),B=o.useRef(null),[R,Ke]=ct(),Se=et(Ne,Ke),se=Q(k),Te=Ge();s=M(s,"modal");const $e=o.useMemo(()=>({onHide:se}),[se]);function ne(){return ee||nt({isRTL:Te})}function ae(l){if(!me)return;const T=ne().getScrollbarWidth()>0,ie=l.scrollHeight>rt(l).documentElement.clientHeight;be({paddingRight:T&&!ie?ce():void 0,paddingLeft:!T&&ie?ce():void 0})}const V=Q(()=>{R&&ae(R.dialog)});lt(()=>{le(window,"resize",V),B.current==null||B.current()});const Be=()=>{_.current=!0},Re=l=>{_.current&&R&&l.target===R.dialog&&(G.current=!0),_.current=!1},re=()=>{te(!0),B.current=ot(R.dialog,()=>{te(!1)})},Ae=l=>{l.target===l.currentTarget&&re()},Ie=l=>{if(g==="static"){Ae(l);return}if(G.current||l.target!==l.currentTarget){G.current=!1;return}k==null||k()},Ue=l=>{j?w==null||w(l):(l.preventDefault(),g==="static"&&re())},Ee=(l,T)=>{l&&ae(l),A==null||A(l,T)},Oe=l=>{B.current==null||B.current(),K==null||K(l)},Fe=(l,T)=>{W==null||W(l,T),at(window,"resize",V)},Pe=l=>{l&&(l.style.display=""),Y==null||Y(l),le(window,"resize",V)},He=o.useCallback(l=>e.jsx("div",{...l,className:C(`${s}-backdrop`,Z,!f&&"show")}),[f,Z,s]),oe={...a,...Me};oe.display="block";const Le=l=>e.jsx("div",{role:"dialog",...l,style:oe,className:C(t,s,ke&&`${s}-static`,!f&&"show"),onClick:g?Ie:void 0,onMouseUp:Re,"data-bs-theme":c,"aria-label":h,"aria-labelledby":m,"aria-describedby":u,children:e.jsx(d,{...Ce,onMouseDown:Be,className:n,contentClassName:i,children:r})});return e.jsx(tt.Provider,{value:$e,children:e.jsx(st,{show:p,ref:Se,backdrop:g,container:H,keyboard:!0,autoFocus:L,enforceFocus:z,restoreFocus:v,restoreFocusOptions:b,onEscapeKeyDown:Ue,onShow:x,onHide:k,onEnter:Ee,onEntering:Fe,onEntered:S,onExit:Oe,onExiting:D,onExited:Pe,manager:ne(),transition:f?ut:void 0,backdropTransition:f?ht:void 0,renderBackdrop:He,renderDialog:Le})})});we.displayName="Modal";const N=Object.assign(we,{Body:je,Header:ge,Title:ve,Footer:pe,Dialog:X,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),F=o.forwardRef(({bsPrefix:s,className:t,as:a="div",...n},i)=>{const r=M(s,"row"),d=Ve(),c=qe(),m=`${r}-cols`,u=[];return d.forEach(h=>{const p=n[h];delete n[h];let f;p!=null&&typeof p=="object"?{cols:f}=p:f=p;const g=h!==c?`-${h}`:"";f!=null&&u.push(`${m}${g}-${f}`)}),e.jsx(a,{ref:i,...n,className:C(t,r,...u)})});F.displayName="Row";function mt({name:s,masterPassword:t,privateKey:a,publicKey:n}){return e.jsx(y,{className:"mb-1",children:e.jsxs(y.Body,{children:[e.jsx(y.Title,{children:s}),t&&e.jsx(y.Text,{className:"mb-1",children:t}),a&&e.jsxs(y.Text,{className:"mb-1",children:[e.jsx("b",{children:"Private Key:"})," ",a]}),n&&e.jsxs(y.Text,{className:"mb-1",children:[e.jsx("b",{children:"Public Key:"})," ",n]})]})})}function ft({username:s,keys:t,copyKeysToClipboardClickedCallback:a}){const n=()=>{const r=i(s,t);navigator.clipboard.writeText(r),a()},i=(r,d)=>{var c,m,u,h,p,f,g,j,w;return`
Account name: @${r}
Master password:
${(c=d.find(x=>x.name==="Master Password"))==null?void 0:c.masterPassword}
-----------------------------------------
Owner key:
Private
${(m=d.find(x=>x.name==="Owner"))==null?void 0:m.privateKey}
Public
${(u=d.find(x=>x.name==="Owner"))==null?void 0:u.publicKey}
-----------------------------------------
Active key:
Private
${(h=d.find(x=>x.name==="Active"))==null?void 0:h.privateKey}
Public
${(p=d.find(x=>x.name==="Active"))==null?void 0:p.publicKey}
-----------------------------------------
Posting key:
Private
${(f=d.find(x=>x.name==="Posting"))==null?void 0:f.privateKey}
Public
${(g=d.find(x=>x.name==="Posting"))==null?void 0:g.publicKey}
-----------------------------------------
Memo key:
Private
${(j=d.find(x=>x.name==="Memo"))==null?void 0:j.privateKey}
Public
${(w=d.find(x=>x.name==="Memo"))==null?void 0:w.publicKey}`.trim()};return e.jsx(y,{className:"w-100",style:{maxWidth:"700px"},children:e.jsxs(y.Body,{children:[e.jsx(y.Title,{children:"New Keys"}),t.map((r,d)=>e.jsx(mt,{...r},d)),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(q,{variant:"outline-secondary",onClick:()=>{n()},children:"Copy Keys to Clipboard"})})})]})})}function de({label:s,checked:t,onChange:a}){return e.jsx("div",{className:"form-check",children:e.jsx(he.Check,{id:s,type:"checkbox",checked:t,onChange:n=>a(n.target.checked),label:s})})}const ue=({type:s,authority:t})=>{const a=s==="account"?t.account_auths:t.key_auths;return e.jsxs(I,{className:"my-2",children:[e.jsx(I.Item,{variant:"secondary",children:e.jsxs(F,{children:[e.jsx($,{children:e.jsx("strong",{children:s==="account"?"Account":"Key"})}),e.jsx($,{className:"text-end",children:e.jsx("strong",{children:"Weight"})})]})}),a.map(([n,i],r)=>e.jsx(I.Item,{children:e.jsxs(F,{children:[e.jsx($,{children:s==="account"?`@${n}`:n.toString()}),e.jsx($,{className:"text-end",children:i})]})},r)),e.jsx(I.Item,{variant:"light",children:e.jsxs(F,{children:[e.jsx($,{children:e.jsx("strong",{children:"Weight Threshold"})}),e.jsx($,{className:"text-end",children:t.weight_threshold})]})},s+" threshold")]})},E=({name:s,authority:t,memoKey:a})=>e.jsxs(y,{className:"mb-2",children:[e.jsx(y.Header,{children:e.jsx(y.Title,{children:s})}),e.jsxs(y.Body,{children:[t&&t.account_auths.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y.Title,{children:"Accounts"}),e.jsx(ue,{type:"account",authority:t})]}),t&&t.key_auths.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y.Title,{children:"Keys"}),e.jsx(ue,{type:"key",authority:t})]}),a&&e.jsx(e.Fragment,{children:e.jsx(y.Text,{children:a.toString()})})]})]}),xt=({label:s,value:t,onChange:a})=>e.jsxs(P,{children:[s?e.jsx(P.Text,{children:s}):null,e.jsx(he.Control,{type:"text",value:t,onChange:n=>a(n.target.value)})]});function yt({updatedAccountData:s,onCancel:t,show:a}){const[n,i]=o.useState(""),[r,d]=o.useState(null),[c,m]=o.useState(!1),[u,h]=o.useState(!1),[p,f]=o.useState(""),g=async()=>{try{const j=await O.accountUpdateBroadcast(s,n);d(j)}catch(j){console.error(j),j instanceof Error&&j.message.includes("Missing Owner Authority")?(h(!0),f("Invalid owner key or master password")):j instanceof Error&&j.message.includes("Owner authority can only be updated twice an hour.")&&(h(!0),f("Owner authority can only be updated twice an hour."))}};return o.useEffect(()=>{r&&r.id.length>0&&(h(!1),m(!0))},[r]),e.jsxs(N,{show:a,onHide:t,children:[e.jsx(N.Header,{children:e.jsx(N.Title,{children:"Broadcast Update"})}),e.jsxs(N.Body,{children:[u&&e.jsx("div",{className:"alert alert-danger",children:p}),e.jsx("p",{children:"Enter your owner key or master password:"}),e.jsx(xt,{value:n,onChange:i}),e.jsx("div",{className:"mt-3 d-flex justify-content-end",children:e.jsx(J,{variant:"outline-primary",onClick:g,children:"Broadcast Update"})}),c&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:"Transaction Broadcasted Successfully!"}),e.jsxs("p",{children:["Transaction ID: ",r.id]}),e.jsx("p",{children:e.jsx("a",{href:`https://hivehub.dev/tx/${r.id}`,target:"_blank",rel:"noopener noreferrer",children:"View on HiveHub"})})]})]})]})}function jt({username:s,updatedAccountData:t,show:a,onCancel:n,onUpdate:i}){return e.jsx(e.Fragment,{children:e.jsxs(N,{size:"lg",centered:!0,show:a,onHide:n,children:[e.jsx(N.Header,{children:e.jsx(N.Title,{children:"Account Update"})}),e.jsx(N.Body,{children:t?e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to update the account ",e.jsxs("b",{children:["@",s]})," ","with the following authorities?"]}),e.jsxs("div",{children:[e.jsx(E,{name:"Owner",authority:t.owner}),e.jsx(E,{name:"Active",authority:t.active}),e.jsx(E,{name:"Posting",authority:t.posting}),e.jsx(E,{name:"Memo Key",memoKey:t.memo_key})]})]}):e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(De,{}),e.jsx("p",{children:"Fetching account data..."})]})}),e.jsxs(N.Footer,{children:[e.jsx(q,{variant:"outline-secondary",onClick:n,children:"Cancel"}),e.jsx(q,{variant:"outline-primary",onClick:i,children:"Update"})]})]})})}function Nt({}){return[{title:"Change Account Keys"},{name:"description",content:"Change Account Keys"}]}const Mt=ze(function(){const[t,a]=o.useState(!1),[n,i]=o.useState(!1),[r,d]=o.useState(!1),[c,m]=o.useState(void 0),[u,h]=o.useState(""),[p,f]=o.useState(!1),[g,j]=o.useState(!1),[w,x]=o.useState(null),k=async v=>{d(!1),i(!1),a(!1);const{masterPassword:b,ownerPrivateKey:S,activePrivateKey:K,postingPrivateKey:D,memoPrivateKey:A}=O.generateNewSetOfKeys(v);m({masterPassword:b,ownerPrivateKey:S,activePrivateKey:K,postingPrivateKey:D,memoPrivateKey:A})},H=()=>t?!0:(alert("Please copy the keys to clipboard first."),!1),L=()=>{if(c){const v=O.createNewAuthoritiesFromKeys(u,c);O.getUpdatedAccountData(u,v).then(b=>{x(b)}),f(!0)}},z=()=>{w&&(f(!1),j(!0))};return e.jsxs("div",{className:"container mt-4 d-flex flex-column justify-content-center align-items-center",children:[e.jsxs(y,{className:"w-100",style:{maxWidth:"700px"},children:[e.jsxs(y.Header,{children:[e.jsx(y.Title,{children:"Change Keys"}),e.jsx(y.Text,{children:"Enter your username to generate new keys."})]}),e.jsxs(y.Body,{children:[e.jsx("div",{className:"row justify-content-center",children:e.jsxs(P,{className:"w-100",style:{maxWidth:"500px"},children:[e.jsx(P.Text,{children:"@"}),e.jsx(We,{onChangeCallback:h,onEnterCallback:()=>k(u),value:u}),e.jsx(J,{variant:"outline-secondary",onClick:()=>{k(u)},children:"Generate Keys"})]})}),c&&e.jsxs("div",{children:[e.jsx("div",{className:"mt-3",children:e.jsx(ft,{username:u,keys:[{name:"Master Password",masterPassword:c==null?void 0:c.masterPassword.toString(),privateKey:void 0,publicKey:void 0},...["Owner","Active","Posting","Memo"].map(v=>{var S,K;const b=v.toLowerCase()+"PrivateKey";return{name:v,masterPassword:void 0,privateKey:(S=c==null?void 0:c[b])==null?void 0:S.toString(),publicKey:(K=c==null?void 0:c[b])==null?void 0:K.createPublic().toString()}})],copyKeysToClipboardClickedCallback:()=>a(!0)})}),e.jsxs("div",{className:"mt-3",children:[e.jsx(de,{label:"I have safely copied the keys and saved them outside of Keychain",checked:n,onChange:v=>{v&&H()&&i(v)}}),e.jsx(de,{label:"I understand that Keychain should not be considered as the primary place of storage for my keys",checked:r,onChange:v=>d(v)})]}),e.jsx("div",{className:"mt-1 d-flex justify-content-end",children:e.jsx(J,{variant:r&&n?"outline-primary":"outline-secondary",onClick:()=>{L()},disabled:!(r&&n),children:"Next"})})]})]})]}),p&&c&&w&&e.jsx(jt,{username:u,updatedAccountData:w,show:p,onCancel:()=>{f(!1),j(!1)},onUpdate:()=>{z()}}),g&&w&&e.jsx(yt,{updatedAccountData:w,onCancel:()=>j(!1),show:g})]})});export{Mt as default,Nt as meta};
